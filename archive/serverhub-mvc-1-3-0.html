<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>ServerHub-MVC 1.3.0 Docs | ServerHub References</title>
    <meta name="description" content="Fast and reliable MVC framework for Nodejs">
    <link rel="icon" href="/favicon.png">
  <link rel="manifest" href="/manifest.json">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:500,400,300|Roboto+Mono">
  <link rel="stylesheet" href="//fonts.googleapis.com/earlyaccess/notosansscsliced.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
  <script src="https://www.googletagmanager.com/gtag/js?id=UA-122724564-2" async="true"></script>
  <script src="/assets/inject.js" async="true"></script>
  <script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());

gtag('config', 'UA-122724564-2');</script>
    
    <link rel="preload" href="/assets/css/0.styles.b028f09f.css" as="style"><link rel="preload" href="/assets/js/app.1dd38295.js" as="script"><link rel="preload" href="/assets/js/7.7c8bdfdf.js" as="script"><link rel="prefetch" href="/assets/js/17.4e4c6ca5.js"><link rel="prefetch" href="/assets/js/2.54d91119.js"><link rel="prefetch" href="/assets/js/3.e3815ec9.js"><link rel="prefetch" href="/assets/js/4.b4bbe4df.js"><link rel="prefetch" href="/assets/js/5.ba8ae864.js"><link rel="prefetch" href="/assets/js/6.a5c16cdb.js"><link rel="prefetch" href="/assets/js/8.14434d8a.js"><link rel="prefetch" href="/assets/js/9.b7b13cdb.js"><link rel="prefetch" href="/assets/js/10.ff6be549.js"><link rel="prefetch" href="/assets/js/11.48a539f4.js"><link rel="prefetch" href="/assets/js/12.45b463a5.js"><link rel="prefetch" href="/assets/js/13.1300dbff.js"><link rel="prefetch" href="/assets/js/14.c4afc325.js"><link rel="prefetch" href="/assets/js/15.ba1ba006.js"><link rel="prefetch" href="/assets/js/16.3ba8b27f.js"><link rel="prefetch" href="/assets/js/18.1c87f19d.js"><link rel="prefetch" href="/assets/js/19.4d0f19bb.js"><link rel="prefetch" href="/assets/js/20.cd6dced5.js"><link rel="prefetch" href="/assets/js/21.a3a63f2b.js"><link rel="prefetch" href="/assets/js/22.1194f43a.js"><link rel="prefetch" href="/assets/js/23.a00289aa.js"><link rel="prefetch" href="/assets/js/24.1ac289f3.js"><link rel="prefetch" href="/assets/js/25.dc6e9a8a.js"><link rel="prefetch" href="/assets/js/26.67142004.js"><link rel="prefetch" href="/assets/js/27.7a506074.js"><link rel="prefetch" href="/assets/js/28.b3c35da4.js"><link rel="prefetch" href="/assets/js/29.0049cb67.js"><link rel="prefetch" href="/assets/js/30.892df537.js"><link rel="prefetch" href="/assets/js/31.5c0cd29b.js"><link rel="prefetch" href="/assets/js/32.2a374046.js"><link rel="prefetch" href="/assets/js/33.090937bb.js"><link rel="prefetch" href="/assets/js/34.4d223979.js"><link rel="prefetch" href="/assets/js/35.6e99ed1c.js">
    <link rel="stylesheet" href="/assets/css/0.styles.b028f09f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div><a href="/" class="home-link router-link-active"><!----><span class="site-name">
      ServerHub References
    </span></a><div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""><!----></div><nav class="nav-links can-hide"><div class="nav-item"><a href="/tutorial/" class="nav-link">Tutorial</a></div><div class="nav-item"><a href="/document/" class="nav-link">Document</a></div><div class="nav-item"><a href="/about/" class="nav-link">About</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Languages</span><span class="arrow right"></span></a><ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----><a href="/archive/serverhub-mvc-1-3-0.html" class="nav-link router-link-exact-active router-link-active">English</a></li><li class="dropdown-item"><!----><a href="/zh/archive/serverhub-mvc-1-3-0.html" class="nav-link">简体中文</a></li></ul></div></div><a href="https://github.com/ServerHubOrg/serverhub-mvc" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header><div class="sidebar-mask"></div><div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/tutorial/" class="nav-link">Tutorial</a></div><div class="nav-item"><a href="/document/" class="nav-link">Document</a></div><div class="nav-item"><a href="/about/" class="nav-link">About</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Languages</span><span class="arrow right"></span></a><ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----><a href="/archive/serverhub-mvc-1-3-0.html" class="nav-link router-link-exact-active router-link-active">English</a></li><li class="dropdown-item"><!----><a href="/zh/archive/serverhub-mvc-1-3-0.html" class="nav-link">简体中文</a></li></ul></div></div><a href="https://github.com/ServerHubOrg/serverhub-mvc" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav><ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span>ServerHub-MVC 1.3.0 Docs</span><!----></p><ul class="sidebar-group-items"><li><a href="/archive/serverhub-mvc-1-3-0.html#controllers" class="sidebar-link">Controllers</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/archive/serverhub-mvc-1-3-0.html#controller-composing" class="sidebar-link">Controller Composing</a></li><li class="sidebar-sub-header"><a href="/archive/serverhub-mvc-1-3-0.html#compile-time-and-static-controllers" class="sidebar-link">Compile-time and Static Controllers</a></li><li class="sidebar-sub-header"><a href="/archive/serverhub-mvc-1-3-0.html#controller-scope-variables" class="sidebar-link">Controller Scope Variables</a></li><li class="sidebar-sub-header"><a href="/archive/serverhub-mvc-1-3-0.html#actions-in-controller" class="sidebar-link">Actions in Controller</a></li><li class="sidebar-sub-header"><a href="/archive/serverhub-mvc-1-3-0.html#about-syntax" class="sidebar-link">About Syntax</a></li></ul></li><li><a href="/archive/serverhub-mvc-1-3-0.html#database" class="sidebar-link">Database</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/archive/serverhub-mvc-1-3-0.html#an-easy-to-use-example" class="sidebar-link">An Easy-to-use Example</a></li><li class="sidebar-sub-header"><a href="/archive/serverhub-mvc-1-3-0.html#two-steps-of-connecting-to-mysql" class="sidebar-link">Two Steps of Connecting to MySQL</a></li><li class="sidebar-sub-header"><a href="/archive/serverhub-mvc-1-3-0.html#a-more-common-way" class="sidebar-link">A More Common Way</a></li></ul></li><li><a href="/archive/serverhub-mvc-1-3-0.html#plugin" class="sidebar-link">Plugin</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/archive/serverhub-mvc-1-3-0.html#plugin-hooks" class="sidebar-link">Plugin hooks</a></li><li class="sidebar-sub-header"><a href="/archive/serverhub-mvc-1-3-0.html#how-to-compose-a-plugin" class="sidebar-link">How to compose a plugin</a></li><li class="sidebar-sub-header"><a href="/archive/serverhub-mvc-1-3-0.html#important-things-to-remember" class="sidebar-link">Important things to remember</a></li></ul></li><li><a href="/archive/serverhub-mvc-1-3-0.html#route" class="sidebar-link">Route</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/archive/serverhub-mvc-1-3-0.html#positive-rules" class="sidebar-link">Positive rules</a></li><li class="sidebar-sub-header"><a href="/archive/serverhub-mvc-1-3-0.html#negative-rules" class="sidebar-link">Negative rules</a></li><li class="sidebar-sub-header"><a href="/archive/serverhub-mvc-1-3-0.html#search-query-in-url" class="sidebar-link">Search/Query in URL</a></li></ul></li><li><a href="/archive/serverhub-mvc-1-3-0.html#run-module-method" class="sidebar-link">Run() Module Method</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/archive/serverhub-mvc-1-3-0.html#serverhub-run" class="sidebar-link">ServerHub.Run()</a></li><li class="sidebar-sub-header"><a href="/archive/serverhub-mvc-1-3-0.html#instance-run-configuration" class="sidebar-link">Instance.Run() Configuration</a></li></ul></li></ul></div></li></ul></div><div class="page"><div class="content"><h1 id="serverhub-mvc-1-3-0-docs"><a href="#serverhub-mvc-1-3-0-docs" aria-hidden="true" class="header-anchor">#</a> ServerHub-MVC 1.3.0 Docs</h1><h2 id="controllers"><a href="#controllers" aria-hidden="true" class="header-anchor">#</a> Controllers</h2><p>Controllers are very important and extremely basic. Routed path will dispatch actions defined in each controller. In this article, we will discuss about controller composing and other essential parts you need to notice.</p><h3 id="controller-composing"><a href="#controller-composing" aria-hidden="true" class="header-anchor">#</a> Controller Composing</h3><p>Here is a good example of <code>home.js</code> custom controller:</p><div class="language-js extra-class"><pre class="language-js"><code><span class="token string">&quot;use strict&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">return</span> <span class="token punctuation">{</span>
  index<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> method<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">View</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  primary<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> method<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> context <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">View</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    context<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">&quot;Ziyuan&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> context<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>Controller files are plain but special JavaScript files. you must return an object providing <strong>action functions</strong> to ServerHub. So when ServerHub dispatching after routing, your custom controller actions can be invoked.</p><p>There are three primary paramters of a controller action method: <em>request</em>, <em>response</em> and <em>method</em>. They are all required.</p><ul><li><strong><em>request</em></strong> refers to the <em>IncomingMessage</em> of Node.js.</li><li><strong><em>response</em></strong> refers to the <em>ServerResponse</em> object of the request.</li><li><strong><em>method</em></strong> is a string and can be the following: GET, POST, PATCH, UPDATE, DELETE and PUT.</li></ul><h3 id="compile-time-and-static-controllers"><a href="#compile-time-and-static-controllers" aria-hidden="true" class="header-anchor">#</a> Compile-time and Static Controllers</h3><p>If you modify any controller files while ServerHub running, check if your browser will show you the latest modifications. There will be no effect when you refresh the web pages. ServerHub loads and registers controllers when the application first starts. And it will never automatically update these files. Not like views and models, ServerHub always cache and renew cached content for them. So that ServerHub can be both fast and stable.</p><p>So, never try to change controller files during ServerHub running.</p><h3 id="controller-scope-variables"><a href="#controller-scope-variables" aria-hidden="true" class="header-anchor">#</a> Controller Scope Variables</h3><p>There are several variables that can be accessed inside controller actions. In order to use them, you must explicitly use pointer <strong><em>this</em></strong> as a reference to the controller instance. Or, there will be an error message displayed.</p><p>You are suggested to use <strong>arrow functions</strong> that accessible since ECMAScript 2015. Or, you may use some workaround to access to those variables (closure or something else).</p><h4 id="complete-list-of-supported-controller-scope-variables"><a href="#complete-list-of-supported-controller-scope-variables" aria-hidden="true" class="header-anchor">#</a> Complete list of supported controller scope variables</h4><p>Usage of these variables are avaliable at <code>doc/variables/{VariableName}.md</code>. Some variables that have primitive types like <code>string</code>, <code>number</code> etc. (as well as some reference to vanilla Node.js implementation) will not be doced, FYI.</p><ul><li><p><code>this.View()</code><strong><em>Function</em></strong> Returns the corresponding model file.</p></li><li><p><code>this.Runtime</code><strong><em>Object</em></strong> Contains bunch of other runtime features.</p><ol><li><code>this.Runtime.DBProvider</code><strong><em>Object</em></strong> A reference to initialized database provider instanced (default MySQL).</li><li><code>this.Runtime.FileHelper</code><strong><em>Object</em></strong> A reference to FileHelper object.</li><li><code>this.Runtime.WAIT</code><strong><em>boolean</em></strong> Force to hold connection until asynchronous operations done.</li></ol></li><li><p><code>this.System</code><strong><em>Object</em></strong> Provide bunch of readonly constants inside ServerHub instance.</p><ol><li><code>this.System.Version</code><strong><em>string</em></strong> ServerHub version.</li><li><code>this.System.NodeVersion</code><strong><em>string</em></strong> Node.js version.</li><li><code>this.System.Platform</code><strong><em>string</em></strong> Platform information (win32, linux, etc.).</li><li><code>this.System.Hardware</code><strong><em>Object</em></strong> Bunch of information about hardware.
<ul><li><code>this.System.Hardware.TotalMemory</code><strong><em>number</em></strong> Installed memory size (byte).</li><li><code>this.System.Hardware.FreeMemory</code><strong><em>number</em></strong> Free memory size (byte).</li><li><code>this.System.Hardware.NetworkInterfaces</code><strong><em>Object</em></strong> Returns interfaces that have been assigned a network address.</li></ul></li><li><code>this.System.Die(exit_code)</code><strong><em>Function</em></strong> Exit current ServerHub process.</li></ol></li></ul><h3 id="actions-in-controller"><a href="#actions-in-controller" aria-hidden="true" class="header-anchor">#</a> Actions in Controller</h3><p>Actions are methods that been invoked when the HTTP request matches a certain route path. And it handles the request and operates on the response. In this chapter, we will discuss about actions in controller and help you learn more about ServerHub controllers.</p><h4 id="how-to-compose-an-action"><a href="#how-to-compose-an-action" aria-hidden="true" class="header-anchor">#</a> How to compose an action</h4><div class="language-js extra-class"><pre class="language-js"><code>index<span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">,</span> method<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// do something</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">View</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>See, this is a very simple 'index' action. You need to declare the action as a function member of an object and return the object as the controller instance. One more thing, as we've mentioned a lot, you should always use 'this' pointer while referencing controller scope variables.</p><p>There are three parameters and they are all required. If you want to manually control server response by calling methods like <code>res.write()</code>, then ServerHub will ignore default render process, which means:</p><div class="language-js extra-class"><pre class="language-js"><code>index<span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">,</span> method<span class="token punctuation">)</span><span class="token punctuation">{</span>
    response<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">'Hello, XWZ'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">View</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>will only output 'Hello, XWZ' and the return value of 'index' action gonna be ignored.</p><p>The <code>request</code> parameter is the vanilla Node.js request (aka <code>IncomingMessage</code> object) (at version 0.0.7). But the <code>response</code> parameter is a virtual <code>ServerResponse</code> object. Several methods and properties are wrapped on that object, which are not exactly the same as the original one. Read the document before invoking. <code>Method</code> is a string that tells the current HTTP method (like GET, POST, etc).</p><h4 id="action-name-convention"><a href="#action-name-convention" aria-hidden="true" class="header-anchor">#</a> Action name convention</h4><p>Action names are all written in lower cases. Characters from 'a' to 'z', with numbers and '_' (underscore) are allowed. There are several reserved action names that you cannot use: Runtime, System, Console, View.</p><p>The best practice are using single words as action names, and verbs are prefered. An action name with more 20 characters are pretty bad. And you should know that in later versions of ServerHub, maybe there will be an limitation of action name length, which might not run functional normally with your old-fashioned code.</p><h3 id="about-syntax"><a href="#about-syntax" aria-hidden="true" class="header-anchor">#</a> About Syntax</h3><p>If you use some lint tools, ServerHub's controller file may report syntax errors. It could tell that &quot;<em>return statement outside function</em>&quot;. But actually they are valid <strong>partial</strong> JavaScript files.</p><p>Controllers scripts are all <strong>functions</strong>, they are not independent JavaScript files. When you try to execute controller files directly, it is not gonna work.</p><p>Here is an example. We have a controller file like this (<code>home.js</code>):</p><div class="language-js extra-class"><pre class="language-js"><code><span class="token string">&quot;use strict&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">return</span> <span class="token punctuation">{</span>
  index<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> method<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">View</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>If you treat this <code>home.js</code> as a plain JavaScript file, there should be curly braces surrounding the return statement. Check this:</p><div class="language-js extra-class"><pre class="language-js"><code><span class="token string">&quot;use strict&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        index<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> method<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">View</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Now, it is an absolute JavaScript file.</p><p><strong>But, do you remember that our controllers are all <em>functions</em></strong>? What does this mean? Your whole controller file is a function, and it has invisible boundries which are curly braces. So, if we manually add function definition to controller file, the loaded controller will be like:</p><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token string">&quot;use strict&quot;</span><span class="token punctuation">;</span>

    <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span>
            index<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> method<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">View</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>As you can see, there is a redundant pair of function braces that should be removed. And this is why we call ServerHub controllers &quot;partial JavaScript files&quot;.</p><hr><h2 id="database"><a href="#database" aria-hidden="true" class="header-anchor">#</a> Database</h2><p>Database is probably the next thing you really want to handle with after you set up the basic of the website. And ServerHub supports some of the most popular databases.</p><p>In this very first beta version of ServerHub, you can interact with MySQL (default) extremely easily with the controller scope variable: <code>this.Runtime.DBProvider</code>.</p><h3 id="an-easy-to-use-example"><a href="#an-easy-to-use-example" aria-hidden="true" class="header-anchor">#</a> An Easy-to-use Example</h3><p>Let's begin with an example (MySQL):</p><div class="language-js extra-class"><pre class="language-js"><code><span class="token string">&quot;use strict&quot;</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    index<span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> method<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> db <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>Runtime<span class="token punctuation">.</span>DBProvider<span class="token punctuation">;</span>
        <span class="token keyword">let</span> conn <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">GetConnection</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            Host<span class="token punctuation">:</span> <span class="token string">&quot;localhost&quot;</span><span class="token punctuation">,</span>
            Username<span class="token punctuation">:</span> <span class="token string">&quot;devchache&quot;</span><span class="token punctuation">,</span>
            Password<span class="token punctuation">:</span> <span class="token string">&quot;ziyuan&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        conn<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span>err <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">throw</span> err<span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>Console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Connected!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">View</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>This is a classic controller script file with 'index' action. Inside the action method, you can see how easily you can interact with MySQL database.</p><h3 id="two-steps-of-connecting-to-mysql"><a href="#two-steps-of-connecting-to-mysql" aria-hidden="true" class="header-anchor">#</a> Two Steps of Connecting to MySQL</h3><p>Basically, there are two steps:</p><ol><li>Get database provider object from <code>this.Runtime.DBProvider</code>. Don't forget to use <code>this</code> reference.</li><li>Get database connection with <code>db.GetConnection()</code> method. If you have already set up the configuration for database connection strings (in your entry file, like <code>app.js</code>), there are no required parameters. But if not, you must provide three parameters: <code>Host</code>, <code>Username</code> and <code>Password</code> (No need to explain more, hah?).</li></ol><p>Now, you can handle with MySQL database.</p><h3 id="a-more-common-way"><a href="#a-more-common-way" aria-hidden="true" class="header-anchor">#</a> A More Common Way</h3><p>Since ServerHub MVC v1.0.3 imported module syntax, you now have the ability to import/require your favorite packages/modules to build a stronger application. You may not need ServerHub's way of accessing databases, but you are always suggested to controller scope variables due to a better integration.</p><hr><h2 id="plugin"><a href="#plugin" aria-hidden="true" class="header-anchor">#</a> Plugin</h2><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>avaliable since v1.0.0-beta</p></div><p>As ServerHub is the foundation of a web server, if you start everything from scratch, then you have to handle with plenty of very basic operations. Just because ServerHub automatically route requests to the corresponding handlers (controllers or static cache), you cannot operate on everything seperately. How about doing something right before routing? Like authentication or filtering. And how about doing something after routing? Like triggering a statistic listener that help you analysis system performance.</p><p>Here, we introduce &quot;plugin&quot; to you. Instructions in this document is pretty simple, but don't miss the chance to build your own plugin!</p><h3 id="plugin-hooks"><a href="#plugin-hooks" aria-hidden="true" class="header-anchor">#</a> Plugin hooks</h3><p>Let's see a picture first. (Tips: right click on the image and choose &quot;open image in new tab&quot; to view high definition image)</p><p><img src="/assets/serverhub-module-plugin-sequence.png" alt="plugin"></p><p>So, when an HTTP request enters ServerHub, it will be handled with ServerHub core module. Then the first phase of plugins will be activated. After all of them successfully go through the data, ServerHub will call route functions to generate a corresponding <code>RouteResult</code>, which contains information about how the request should be handled (where, who). Next, the other phase of plugins will be activated to operate on the data.</p><p>The two phase of plugins are <strong>before-route</strong> plugin and <strong>after-route</strong> plugin.</p><p>Before-route plugins usually do not care about where will the request be sent to with route. It can do some global operations like authentication. After-route plugins usually concentrate on one specific kind of different request types. Some receive requests for controllers while others focus on handling cache-able static resources.</p><h3 id="how-to-compose-a-plugin"><a href="#how-to-compose-a-plugin" aria-hidden="true" class="header-anchor">#</a> How to compose a plugin</h3><p>A plugin is exactly a Node.js module. It has to obey all the rules for Node.js modules. But here are some limits:</p><ul><li><p>A valid plugin must have at least the following properties:</p><ul><li><code>app_name</code> A unique name for your plugin. All the letters must be in lower cases. Valid ones include alphanumeric characters and single dashes, eg: serverhub-plugin-my-filter (the serverhub-plugin- prefix is required).</li><li><code>version</code> Version tag for your plugin. Suggested to follow NPM custom.</li><li><code>version_support</code> Indicates the least version of ServerHub to run the plugin.</li><li><code>phase</code> Whether this is a after-route or before-route plugin.</li><li><code>main</code> Entry function for your plugin. For before-route plugins, 2 parameters are required; for after-route plugins, 3 parameters are requried.</li></ul></li><li><p>Here is an example</p></li></ul><div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  app_name<span class="token punctuation">:</span> <span class="token string">&quot;serverhub-plugin-my-plugin&quot;</span><span class="token punctuation">,</span>
  version<span class="token punctuation">:</span> <span class="token string">&quot;0.1.0&quot;</span><span class="token punctuation">,</span>
  version_support<span class="token punctuation">:</span> <span class="token string">&quot;1.0.0-alpha&quot;</span><span class="token punctuation">,</span>
  phase<span class="token punctuation">:</span> <span class="token string">&quot;before-route&quot;</span><span class="token punctuation">,</span>
  main<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Hello, this is my first ServerHub plugin!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="important-things-to-remember"><a href="#important-things-to-remember" aria-hidden="true" class="header-anchor">#</a> Important things to remember</h3><div class="warning custom-block"><p class="custom-block-title">Keep this in mind:</p><p><strong>NEVER try to modify response parameter passing to your plugin <code>main</code> function!</strong></p></div><hr><h2 id="route"><a href="#route" aria-hidden="true" class="header-anchor">#</a> Route</h2><p>Route is one of ServerHub's core features. With route, all HTTP request can be filtered and send to correct handlers. For example, <code>/index.html</code> might be a static webpage, but <code>/home/index</code> could be a controller URL. ServerHub's route system provide two ways to deal with it. One is called positive rules and the other one is called negative rules.</p><h3 id="positive-rules"><a href="#positive-rules" aria-hidden="true" class="header-anchor">#</a> Positive rules</h3><p>Positive rules looks like JavaScript string formatting. There are several '{' and '}' symbols in the rule content. Between each pair of parenthess lies the segment name of rule syntax. Valid segment names are: controller, action and id. For example: <code>&quot;api/{controller}/{action}/{id}&quot;</code>.</p><p>Prefix <code>api</code> is a normal string. Every request that matches the rule should start with this prefix.</p><p><code>controller</code> is the name of controller, which is right the name of the controller file.</p><p><code>action</code> is the function property defined in controller scripts.</p><p>Here we have some examples (assuming that you have home controller with index/info actions in your project):</p><div class="language- extra-class"><pre class="language-text"><code>Valid request path:
  /api/home/index
  /api/home/info/
  /api/home/index/5
  /api/home/index/5?name=xu_wangzhe
  /api/home/index/?name=xu_wangzhe

Invalid request path:
  /home/index
  /api/home/index.html
  /api/home/5
  /api/index/5?name=xu_wangzhe
  /api/home-foo/index/?name=xu_wangzhe
</code></pre></div><p>Request paths that does not match the route rule will be treated as requests to static resources.</p><p>But how to set positive rule? Look at this:</p><div class="language-js extra-class"><pre class="language-js"><code>route <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  route<span class="token punctuation">.</span><span class="token function">MapRoute</span><span class="token punctuation">(</span><span class="token string">&quot;default&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;v1/{controller}/{action}/{id}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>Pass this annoymous function as the second parameter of <code>instance.Run()</code> method.</p><h3 id="negative-rules"><a href="#negative-rules" aria-hidden="true" class="header-anchor">#</a> Negative rules</h3><p><strong>Negative rules are checked ahead of any positive rules</strong>. If any request path matched any negative rule, it will immediately be treated as static resources.</p><p>Negative rules support <strong>both</strong> string rule definition and regular expressions. An array is used to contain all the rules needed.</p><p>Here are three examples:</p><h4 id="string-rule-example"><a href="#string-rule-example" aria-hidden="true" class="header-anchor">#</a> String rule example</h4><div class="language-js extra-class"><pre class="language-js"><code>route<span class="token punctuation">.</span><span class="token function">IgnoreRoute</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&quot;/language/all&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>As you can see. The <code>language</code> controller may have <code>english</code> and <code>chinese</code> actions, but <code>all</code> is not an action. If we don't ignore this route, ServerHub will try to seek for action named <code>all</code>, which will fire an exception. So, we use this string rule to ignore specific request path.</p><p>One thing that you should know about string negative route rule is: your rules should always start with '/'.</p><h4 id="regular-expression-example"><a href="#regular-expression-example" aria-hidden="true" class="header-anchor">#</a> Regular expression example</h4><p>What if want to ignore all routes that start with &quot;no-route&quot;? Should we write every possibilities? Of course, that is not possible. So we use the regular expression above to ignore all request with prefix &quot;no-route&quot; (upper-case or lower-case)</p><div class="language-js extra-class"><pre class="language-js"><code>route<span class="token punctuation">.</span><span class="token function">IgnoreRoute</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token regex">/^\/no-route.*$/i</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="multiple-negative-rules"><a href="#multiple-negative-rules" aria-hidden="true" class="header-anchor">#</a> Multiple negative rules</h4><div class="language-js extra-class"><pre class="language-js"><code>route<span class="token punctuation">.</span><span class="token function">IgnoreRoute</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&quot;/language/all&quot;</span><span class="token punctuation">,</span> <span class="token regex">/^\/no-route.*$/i</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="search-query-in-url"><a href="#search-query-in-url" aria-hidden="true" class="header-anchor">#</a> Search/Query in URL</h3><p>According to <a href="https://tools.ietf.org/html/rfc1738" target="_blank" rel="noopener noreferrer">RFC 1738<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>, a valid search in URL is defined as follows:</p><div class="language-rfc extra-class"><pre class="language-text"><code>search         = *[ uchar | &quot;;&quot; | &quot;:&quot; | &quot;@&quot; | &quot;&amp;&quot; | &quot;=&quot; ]
uchar          = unreserved | escape
unreserved     = alpha | digit | safe | extra
alpha          = lowalpha | hialpha
lowalpha       = &quot;a&quot; | &quot;b&quot; | &quot;c&quot; | &quot;d&quot; | &quot;e&quot; | &quot;f&quot; | &quot;g&quot; | &quot;h&quot; |
                 &quot;i&quot; | &quot;j&quot; | &quot;k&quot; | &quot;l&quot; | &quot;m&quot; | &quot;n&quot; | &quot;o&quot; | &quot;p&quot; |
                 &quot;q&quot; | &quot;r&quot; | &quot;s&quot; | &quot;t&quot; | &quot;u&quot; | &quot;v&quot; | &quot;w&quot; | &quot;x&quot; |
                 &quot;y&quot; | &quot;z&quot;
hialpha        = &quot;A&quot; | &quot;B&quot; | &quot;C&quot; | &quot;D&quot; | &quot;E&quot; | &quot;F&quot; | &quot;G&quot; | &quot;H&quot; | &quot;I&quot; |
                 &quot;J&quot; | &quot;K&quot; | &quot;L&quot; | &quot;M&quot; | &quot;N&quot; | &quot;O&quot; | &quot;P&quot; | &quot;Q&quot; | &quot;R&quot; |
                 &quot;S&quot; | &quot;T&quot; | &quot;U&quot; | &quot;V&quot; | &quot;W&quot; | &quot;X&quot; | &quot;Y&quot; | &quot;Z&quot;
digit          = &quot;0&quot; | &quot;1&quot; | &quot;2&quot; | &quot;3&quot; | &quot;4&quot; | &quot;5&quot; | &quot;6&quot; | &quot;7&quot; |
                 &quot;8&quot; | &quot;9&quot;
safe           = &quot;$&quot; | &quot;-&quot; | &quot;_&quot; | &quot;.&quot; | &quot;+&quot;
extra          = &quot;!&quot; | &quot;*&quot; | &quot;'&quot; | &quot;(&quot; | &quot;)&quot; | &quot;,&quot;
escape         = &quot;%&quot; hex hex
hex            = digit | &quot;A&quot; | &quot;B&quot; | &quot;C&quot; | &quot;D&quot; | &quot;E&quot; | &quot;F&quot; |
                 &quot;a&quot; | &quot;b&quot; | &quot;c&quot; | &quot;d&quot; | &quot;e&quot; | &quot;f&quot;
</code></pre></div><p>More specificly, ServerHub allows:</p><ul><li><code>?</code> as the start of a search/query.</li><li>Identifier before <code>=</code> is used as search key.</li><li>Identifier after <code>=</code> is used as search value.</li><li>Search items use <code>&amp;</code> as delimiter.</li></ul><p>Please always obey the above rules, later versions of ServerHub might eable &quot;strict mode&quot; to force ignore search/query with invalid characters.</p><hr><h2 id="run-module-method"><a href="#run-module-method" aria-hidden="true" class="header-anchor">#</a> Run() Module Method</h2><h3 id="serverhub-run"><a href="#serverhub-run" aria-hidden="true" class="header-anchor">#</a> ServerHub.Run()</h3><p><a href="/tutorial/getting-started.html#usage">View this</a>. This chapter includes brief introduction of ServerHub instance Run() method.</p><h3 id="instance-run-configuration"><a href="#instance-run-configuration" aria-hidden="true" class="header-anchor">#</a> Instance.Run() Configuration</h3><p>The other day, I introduced <code>instance.Run()</code> method to you. And in this chapter, we will talk about the first parameter of <code>instance.Run()</code> method - the configuration object.</p><h4 id="as-simple-as-possible"><a href="#as-simple-as-possible" aria-hidden="true" class="header-anchor">#</a> As simple as possible</h4><p>Not like what we've seen in <a href="/tutorial/getting-started.html#usage">Usage</a> chapter, the configuraton object is much too complicated. And in fact, there is only one property that is required: <code>BaseDir</code>.</p><p><code>BaseDir</code> is the root path of server, which will be used during the whole life circle of your ServerHub application. If your current entry file, such as <code>app.js</code>, is just located in the directory that you want to use as server root. Then the value should be <code>__dirname</code>, which is a global variable of Node.js.</p><p>This is the simplest configuration that can make ServerHub work functional normally.</p><h4 id="other-properties"><a href="#other-properties" aria-hidden="true" class="header-anchor">#</a> Other properties</h4><p>To customize ServerHub, you need some extra configurations.</p><h5 id="webdir"><a href="#webdir" aria-hidden="true" class="header-anchor">#</a> WebDir</h5><p><code>WebDir</code> is website directory. Your page files, contents, scripts and assets should be put in this directory. ServerHub uses &quot;www/&quot; as its default value. If you want to set up a new website root directory, create a folder and pass its name to <code>WebDir</code> property.</p><h5 id="controllerdir"><a href="#controllerdir" aria-hidden="true" class="header-anchor">#</a> ControllerDir</h5><p>We all know that ServerHub routes request to controllers. If we want them to be registered, we have to provide the contain directory name to ServerHub. The path of controller directory should be relative to server root path. If you don't specify one, the default value will be &quot;controller/&quot;.</p><h5 id="controllers-2"><a href="#controllers-2" aria-hidden="true" class="header-anchor">#</a> Controllers</h5><p>Sometimes, we don't want to register every controller in the contain folder. Then we can pass an array of required controller file name to this parameter. eg: <code>['home.js', 'data.js']</code>. But if you want all controller files to be registered, just ignore <code>Controllers</code> property and ServerHub will automatically scan and register every file under <code>ControllerDir</code>.</p><h5 id="viewdir-and-modeldir"><a href="#viewdir-and-modeldir" aria-hidden="true" class="header-anchor">#</a> ViewDir and ModelDir</h5><p>Pretty similar to <code>ControllerDir</code> in previous section. They are used to hold view files and models.</p><h5 id="dbprovider"><a href="#dbprovider" aria-hidden="true" class="header-anchor">#</a> DBProvider</h5><p>Specify your database provider. In current version, ServerHub only supports MySQL, which means the only valid value would be &quot;mysql&quot;.</p><h5 id="dbconnectionstring"><a href="#dbconnectionstring" aria-hidden="true" class="header-anchor">#</a> DBConnectionString</h5><p>If you have only one database instance to connect, the suggested way is to pass a global database connection string to ServerHub. Because if you don't, you will have to provide a value every time you call <code>GetConnection()</code> method on your database provider.</p><h5 id="maxcachesize"><a href="#maxcachesize" aria-hidden="true" class="header-anchor">#</a> MaxCacheSize</h5><p>This specifies how much memory can ServerHub caching system allocate. If file sizes exceeded this limit, then ServerHub will call WCS to unload some unnecessary caches. This will be covered in later chapters.</p><h5 id="defaultpages"><a href="#defaultpages" aria-hidden="true" class="header-anchor">#</a> DefaultPages</h5><p>ServerHub uses a fallback strategy for default pages. And your default page file must be put under the root of <code>WebDir</code> directory. In default, ServerHub uses &quot;index.html&quot; first, then &quot;default.html&quot; and finally &quot;page.html&quot;. You can override this configuration by passing an array like <code>['hello.html', 'first.html']</code> to this property.</p><h5 id="pagenotfound-v0-0-93"><a href="#pagenotfound-v0-0-93" aria-hidden="true" class="header-anchor">#</a> PageNotFound <code>v0.0.93+</code></h5><p>When the request does not match any resources or route rules, ServerHub will render an error page to the response. From v0.0.93, you can add your custom error page to ServerHub server directory and specify with this property.</p><p>More property definitions are coming soon.</p><h5 id="asyncoperationtimeout-v0-0-97"><a href="#asyncoperationtimeout-v0-0-97" aria-hidden="true" class="header-anchor">#</a> AsyncOperationTimeout <code>v0.0.97+</code></h5><p>In <code>v0.0.96</code>, we introduced <code>this.Runtime.WAIT</code> signal to be the workaroud for some time consuming asynchronous operations, such as database query etc. But you should know this signal is pretty dangrous. What if you <code>forget</code> to set false to it or the operation takes too much time and dead before callback? So, ServerHub has to count down as a backup operation if it cost too much time. The default value is 10 seconds. If you want it to be shorter or longer, just pass the value to the configuration parameter.(Unit: <strong>milliseconds</strong>)</p><h5 id="tlsoption-v1-0-6"><a href="#tlsoption-v1-0-6" aria-hidden="true" class="header-anchor">#</a> TLSOption <code>v1.0.6+</code></h5><p>Since <code>v1.0.6</code>, ServerHub enhanced security with TLS/SSL. You may secure the connection with a <code>TLSOption</code> property. This property has four sub-properties: <code>Key: string, Cert: string, CA: string</code>x and <code>Port: Array&lt;string&gt;|Array&lt;number&gt;|number|string</code>. You need to load your private key and certificate files and assign their values to the properties above. And most importantly, you need to specify the port you want to secure.</p><p>Here is a <a href="/tutorial/tls-tutorial.html">tutorial</a> help you with TLS in ServerHub MVC.</p></div><div class="page-edit"><div class="edit-link"><a href="https://github.com/ServerHubOrg/serverhub-docs/edit/dev/docs/archive/serverhub-mvc-1-3-0.md" target="_blank" rel="noopener noreferrer">Edit this page on Github</a><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div><!----></div><!----></div></div></div>
    <script src="/assets/js/7.7c8bdfdf.js" defer></script><script src="/assets/js/app.1dd38295.js" defer></script>
  </body>
</html>
