<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Controllers | ServerHub References</title>
    <meta name="description" content="Fast and reliable MVC framework for Nodejs">
    <link rel="icon" href="/favicon.png">
  <link rel="manifest" href="/manifest.json">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:500,400,300|Roboto+Mono">
  <link rel="stylesheet" href="//fonts.googleapis.com/earlyaccess/notosansscsliced.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
  <script src="https://www.googletagmanager.com/gtag/js?id=UA-122724564-2" async="true"></script>
  <script src="/assets/inject.js" async="true"></script>
  <script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());

gtag('config', 'UA-122724564-2');</script>
    
    <link rel="preload" href="/assets/css/0.styles.b028f09f.css" as="style"><link rel="preload" href="/assets/js/app.1dd38295.js" as="script"><link rel="preload" href="/assets/js/10.ff6be549.js" as="script"><link rel="prefetch" href="/assets/js/17.4e4c6ca5.js"><link rel="prefetch" href="/assets/js/2.54d91119.js"><link rel="prefetch" href="/assets/js/3.e3815ec9.js"><link rel="prefetch" href="/assets/js/4.b4bbe4df.js"><link rel="prefetch" href="/assets/js/5.ba8ae864.js"><link rel="prefetch" href="/assets/js/6.a5c16cdb.js"><link rel="prefetch" href="/assets/js/7.7c8bdfdf.js"><link rel="prefetch" href="/assets/js/8.14434d8a.js"><link rel="prefetch" href="/assets/js/9.b7b13cdb.js"><link rel="prefetch" href="/assets/js/11.48a539f4.js"><link rel="prefetch" href="/assets/js/12.45b463a5.js"><link rel="prefetch" href="/assets/js/13.1300dbff.js"><link rel="prefetch" href="/assets/js/14.c4afc325.js"><link rel="prefetch" href="/assets/js/15.ba1ba006.js"><link rel="prefetch" href="/assets/js/16.3ba8b27f.js"><link rel="prefetch" href="/assets/js/18.1c87f19d.js"><link rel="prefetch" href="/assets/js/19.4d0f19bb.js"><link rel="prefetch" href="/assets/js/20.cd6dced5.js"><link rel="prefetch" href="/assets/js/21.a3a63f2b.js"><link rel="prefetch" href="/assets/js/22.1194f43a.js"><link rel="prefetch" href="/assets/js/23.a00289aa.js"><link rel="prefetch" href="/assets/js/24.1ac289f3.js"><link rel="prefetch" href="/assets/js/25.dc6e9a8a.js"><link rel="prefetch" href="/assets/js/26.67142004.js"><link rel="prefetch" href="/assets/js/27.7a506074.js"><link rel="prefetch" href="/assets/js/28.b3c35da4.js"><link rel="prefetch" href="/assets/js/29.0049cb67.js"><link rel="prefetch" href="/assets/js/30.892df537.js"><link rel="prefetch" href="/assets/js/31.5c0cd29b.js"><link rel="prefetch" href="/assets/js/32.2a374046.js"><link rel="prefetch" href="/assets/js/33.090937bb.js"><link rel="prefetch" href="/assets/js/34.4d223979.js"><link rel="prefetch" href="/assets/js/35.6e99ed1c.js">
    <link rel="stylesheet" href="/assets/css/0.styles.b028f09f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div><a href="/" class="home-link router-link-active"><!----><span class="site-name">
      ServerHub References
    </span></a><div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""><!----></div><nav class="nav-links can-hide"><div class="nav-item"><a href="/tutorial/" class="nav-link">Tutorial</a></div><div class="nav-item"><a href="/document/" class="nav-link router-link-active">Document</a></div><div class="nav-item"><a href="/about/" class="nav-link">About</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Languages</span><span class="arrow right"></span></a><ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----><a href="/document/controller.html" class="nav-link router-link-exact-active router-link-active">English</a></li><li class="dropdown-item"><!----><a href="/zh/document/controller.html" class="nav-link">简体中文</a></li></ul></div></div><a href="https://github.com/ServerHubOrg/serverhub-mvc" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header><div class="sidebar-mask"></div><div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/tutorial/" class="nav-link">Tutorial</a></div><div class="nav-item"><a href="/document/" class="nav-link router-link-active">Document</a></div><div class="nav-item"><a href="/about/" class="nav-link">About</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Languages</span><span class="arrow right"></span></a><ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----><a href="/document/controller.html" class="nav-link router-link-exact-active router-link-active">English</a></li><li class="dropdown-item"><!----><a href="/zh/document/controller.html" class="nav-link">简体中文</a></li></ul></div></div><a href="https://github.com/ServerHubOrg/serverhub-mvc" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav><ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span>Document</span><!----></p><ul class="sidebar-group-items"><li><a href="/document/" class="sidebar-link">Document</a></li><li><a href="/document/run-module-method.html" class="sidebar-link">Run() Module Method</a></li><li><a href="/document/controller.html" class="active sidebar-link">Controllers</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/document/controller.html#controller-composing" class="sidebar-link">Controller Composing</a></li><li class="sidebar-sub-header"><a href="/document/controller.html#compile-time-and-static-controllers" class="sidebar-link">Compile-time and Static Controllers</a></li><li class="sidebar-sub-header"><a href="/document/controller.html#controller-scope-variables" class="sidebar-link">Controller Scope Variables</a></li><li class="sidebar-sub-header"><a href="/document/controller.html#actions-in-controller" class="sidebar-link">Actions in Controller</a></li><li class="sidebar-sub-header"><a href="/document/controller.html#about-syntax" class="sidebar-link">About Syntax</a></li></ul></li><li><a href="/document/route.html" class="sidebar-link">Route</a></li><li><a href="/document/plugin.html" class="sidebar-link">Plugin</a></li><li><a href="/document/database.html" class="sidebar-link">Database</a></li><li><a href="/document/middleware.html" class="sidebar-link">Middleware</a></li><li><a href="/document/archive.html" class="sidebar-link">Archives</a></li></ul></div></li></ul></div><div class="page"><div class="content"><h1 id="controllers"><a href="#controllers" aria-hidden="true" class="header-anchor">#</a> Controllers</h1><p>Controllers are very important and extremely basic. Routed path will dispatch actions defined in each controller. In this article, we will discuss about controller composing and other essential parts you need to notice.</p><h2 id="controller-composing"><a href="#controller-composing" aria-hidden="true" class="header-anchor">#</a> Controller Composing</h2><p>Here is a good example of <code>home.js</code> custom controller:</p><div class="language-js extra-class"><pre class="language-js"><code><span class="token string">&quot;use strict&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">return</span> <span class="token punctuation">{</span>
  index<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> method<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">View</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  primary<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> method<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> context <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">View</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    context<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">&quot;Ziyuan&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> context<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>Controller files are plain but special JavaScript files. you must return an object providing <strong>action functions</strong> to ServerHub. So when ServerHub dispatching after routing, your custom controller actions can be invoked.</p><p>There are three primary paramters of a controller action method: <em>request</em>, <em>response</em> and <em>method</em>. They are all required.</p><ul><li><strong><em>request</em></strong> refers to the <em>IncomingMessage</em> of Node.js.</li><li><strong><em>response</em></strong> refers to the <em>ServerResponse</em> object of the request.</li><li><strong><em>method</em></strong> is a string and can be the following: GET, POST, PATCH, UPDATE, DELETE and PUT.</li></ul><h2 id="compile-time-and-static-controllers"><a href="#compile-time-and-static-controllers" aria-hidden="true" class="header-anchor">#</a> Compile-time and Static Controllers</h2><p>If you modify any controller files while ServerHub running, check if your browser will show you the latest modifications. There will be no effect when you refresh the web pages. ServerHub loads and registers controllers when the application first starts. And it will never automatically update these files. Not like views and models, ServerHub always cache and renew cached content for them. So that ServerHub can be both fast and stable.</p><p>So, never try to change controller files during ServerHub running.</p><h2 id="controller-scope-variables"><a href="#controller-scope-variables" aria-hidden="true" class="header-anchor">#</a> Controller Scope Variables</h2><p>There are several variables that can be accessed inside controller actions. In order to use them, you must explicitly use pointer <strong><em>this</em></strong> as a reference to the controller instance. Or, there will be an error message displayed.</p><p>You are suggested to use <strong>arrow functions</strong> that accessible since ECMAScript 2015. Or, you may use some workaround to access to those variables (closure or something else).</p><h3 id="complete-list-of-supported-controller-scope-variables"><a href="#complete-list-of-supported-controller-scope-variables" aria-hidden="true" class="header-anchor">#</a> Complete list of supported controller scope variables</h3><p>Usage of these variables are avaliable at <code>doc/variables/{VariableName}.md</code>. Some variables that have primitive types like <code>string</code>, <code>number</code> etc. (as well as some reference to vanilla Node.js implementation) will not be doced, FYI.</p><ul><li><p><code>this.View()</code><strong><em>Function</em></strong> Returns the corresponding model file.</p></li><li><p><code>this.Runtime</code><strong><em>Object</em></strong> Contains bunch of other runtime features.</p><ol><li><code>this.Runtime.DBProvider</code><strong><em>Object</em></strong> A reference to initialized database provider instanced (default MySQL).</li><li><code>this.Runtime.FileHelper</code><strong><em>Object</em></strong> A reference to FileHelper object.</li><li><code>this.Runtime.WAIT</code><strong><em>boolean</em></strong> Force to hold connection until asynchronous operations done.</li></ol></li><li><p><code>this.System</code><strong><em>Object</em></strong> Provide bunch of readonly constants inside ServerHub instance.</p><ol><li><code>this.System.Version</code><strong><em>string</em></strong> ServerHub version.</li><li><code>this.System.NodeVersion</code><strong><em>string</em></strong> Node.js version.</li><li><code>this.System.Platform</code><strong><em>string</em></strong> Platform information (win32, linux, etc.).</li><li><code>this.System.Hardware</code><strong><em>Object</em></strong> Bunch of information about hardware.
<ul><li><code>this.System.Hardware.TotalMemory</code><strong><em>number</em></strong> Installed memory size (byte).</li><li><code>this.System.Hardware.FreeMemory</code><strong><em>number</em></strong> Free memory size (byte).</li><li><code>this.System.Hardware.NetworkInterfaces</code><strong><em>Object</em></strong> Returns interfaces that have been assigned a network address.</li></ul></li><li><code>this.System.Die(exit_code)</code><strong><em>Function</em></strong> Exit current ServerHub process.</li></ol></li></ul><h2 id="actions-in-controller"><a href="#actions-in-controller" aria-hidden="true" class="header-anchor">#</a> Actions in Controller</h2><p>Actions are methods that been invoked when the HTTP request matches a certain route path. And it handles the request and operates on the response. In this chapter, we will discuss about actions in controller and help you learn more about ServerHub controllers.</p><h3 id="how-to-compose-an-action"><a href="#how-to-compose-an-action" aria-hidden="true" class="header-anchor">#</a> How to compose an action</h3><div class="language-js extra-class"><pre class="language-js"><code>index<span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">,</span> method<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// do something</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">View</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>See, this is a very simple 'index' action. You need to declare the action as a function member of an object and return the object as the controller instance. One more thing, as we've mentioned a lot, you should always use 'this' pointer while referencing controller scope variables.</p><p>There are three parameters and they are all required. If you want to manually control server response by calling methods like <code>res.write()</code>, then ServerHub will ignore default render process, which means:</p><div class="language-js extra-class"><pre class="language-js"><code>index<span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">,</span> method<span class="token punctuation">)</span><span class="token punctuation">{</span>
    response<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">'Hello, XWZ'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">View</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>will only output 'Hello, XWZ' and the return value of 'index' action gonna be ignored.</p><p>The <code>request</code> parameter is the vanilla Node.js request (aka <code>IncomingMessage</code> object) (at version 0.0.7). But the <code>response</code> parameter is a virtual <code>ServerResponse</code> object. Several methods and properties are wrapped on that object, which are not exactly the same as the original one. Read the document before invoking. <code>Method</code> is a string that tells the current HTTP method (like GET, POST, etc).</p><h3 id="action-name-convention"><a href="#action-name-convention" aria-hidden="true" class="header-anchor">#</a> Action name convention</h3><p>Action names are all written in lower cases. Characters from 'a' to 'z', with numbers and '_' (underscore) are allowed. There are several reserved action names that you cannot use: Runtime, System, Console, View.</p><p>The best practice are using single words as action names, and verbs are prefered. An action name with more 20 characters are pretty bad. And you should know that in later versions of ServerHub, maybe there will be an limitation of action name length, which might not run functional normally with your old-fashioned code.</p><h2 id="about-syntax"><a href="#about-syntax" aria-hidden="true" class="header-anchor">#</a> About Syntax</h2><p>If you use some lint tools, ServerHub's controller file may report syntax errors. It could tell that &quot;<em>return statement outside function</em>&quot;. But actually they are valid <strong>partial</strong> JavaScript files.</p><p>Controllers scripts are all <strong>functions</strong>, they are not independent JavaScript files. When you try to execute controller files directly, it is not gonna work.</p><p>Here is an example. We have a controller file like this (<code>home.js</code>):</p><div class="language-js extra-class"><pre class="language-js"><code><span class="token string">&quot;use strict&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">return</span> <span class="token punctuation">{</span>
  index<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> method<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">View</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>If you treat this <code>home.js</code> as a plain JavaScript file, there should be curly braces surrounding the return statement. Check this:</p><div class="language-js extra-class"><pre class="language-js"><code><span class="token string">&quot;use strict&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        index<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> method<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">View</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Now, it is an absolute JavaScript file.</p><p><strong>But, do you remember that our controllers are all <em>functions</em></strong>? What does this mean? Your whole controller file is a function, and it has invisible boundries which are curly braces. So, if we manually add function definition to controller file, the loaded controller will be like:</p><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token string">&quot;use strict&quot;</span><span class="token punctuation">;</span>

    <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span>
            index<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> method<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">View</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>As you can see, there is a redundant pair of function braces that should be removed. And this is why we call ServerHub controllers &quot;partial JavaScript files&quot;.</p></div><div class="page-edit"><div class="edit-link"><a href="https://github.com/ServerHubOrg/serverhub-docs/edit/dev/docs/document/controller.md" target="_blank" rel="noopener noreferrer">Edit this page on Github</a><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div><!----></div><div class="page-nav"><p class="inner"><span class="prev"><i class="material-icons">arrow_back</i><a href="/document/run-module-method.html" class="prev">
          Run() Module Method
        </a></span><span class="next"><a href="/document/route.html">
          Route
        </a><i class="material-icons">arrow_forward</i></span></p></div></div></div></div>
    <script src="/assets/js/10.ff6be549.js" defer></script><script src="/assets/js/app.1dd38295.js" defer></script>
  </body>
</html>
