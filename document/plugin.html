<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Plugin | ServerHub References</title>
    <meta name="description" content="Fast and reliable MVC framework for Nodejs">
    <link rel="icon" href="/favicon.png">
  <link rel="manifest" href="/manifest.json">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:500,400,300|Roboto+Mono">
  <link rel="stylesheet" href="//fonts.googleapis.com/earlyaccess/notosansscsliced.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
  <script src="https://www.googletagmanager.com/gtag/js?id=UA-122724564-2" async="true"></script>
  <script src="/assets/inject.js" async="true"></script>
  <script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());

gtag('config', 'UA-122724564-2');</script>
    
    <link rel="preload" href="/assets/css/0.styles.b028f09f.css" as="style"><link rel="preload" href="/assets/js/app.1dd38295.js" as="script"><link rel="preload" href="/assets/js/13.1300dbff.js" as="script"><link rel="prefetch" href="/assets/js/17.4e4c6ca5.js"><link rel="prefetch" href="/assets/js/2.54d91119.js"><link rel="prefetch" href="/assets/js/3.e3815ec9.js"><link rel="prefetch" href="/assets/js/4.b4bbe4df.js"><link rel="prefetch" href="/assets/js/5.ba8ae864.js"><link rel="prefetch" href="/assets/js/6.a5c16cdb.js"><link rel="prefetch" href="/assets/js/7.7c8bdfdf.js"><link rel="prefetch" href="/assets/js/8.14434d8a.js"><link rel="prefetch" href="/assets/js/9.b7b13cdb.js"><link rel="prefetch" href="/assets/js/10.ff6be549.js"><link rel="prefetch" href="/assets/js/11.48a539f4.js"><link rel="prefetch" href="/assets/js/12.45b463a5.js"><link rel="prefetch" href="/assets/js/14.c4afc325.js"><link rel="prefetch" href="/assets/js/15.ba1ba006.js"><link rel="prefetch" href="/assets/js/16.3ba8b27f.js"><link rel="prefetch" href="/assets/js/18.1c87f19d.js"><link rel="prefetch" href="/assets/js/19.4d0f19bb.js"><link rel="prefetch" href="/assets/js/20.cd6dced5.js"><link rel="prefetch" href="/assets/js/21.a3a63f2b.js"><link rel="prefetch" href="/assets/js/22.1194f43a.js"><link rel="prefetch" href="/assets/js/23.a00289aa.js"><link rel="prefetch" href="/assets/js/24.1ac289f3.js"><link rel="prefetch" href="/assets/js/25.dc6e9a8a.js"><link rel="prefetch" href="/assets/js/26.67142004.js"><link rel="prefetch" href="/assets/js/27.7a506074.js"><link rel="prefetch" href="/assets/js/28.b3c35da4.js"><link rel="prefetch" href="/assets/js/29.0049cb67.js"><link rel="prefetch" href="/assets/js/30.892df537.js"><link rel="prefetch" href="/assets/js/31.5c0cd29b.js"><link rel="prefetch" href="/assets/js/32.2a374046.js"><link rel="prefetch" href="/assets/js/33.090937bb.js"><link rel="prefetch" href="/assets/js/34.4d223979.js"><link rel="prefetch" href="/assets/js/35.6e99ed1c.js">
    <link rel="stylesheet" href="/assets/css/0.styles.b028f09f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div><a href="/" class="home-link router-link-active"><!----><span class="site-name">
      ServerHub References
    </span></a><div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""><!----></div><nav class="nav-links can-hide"><div class="nav-item"><a href="/tutorial/" class="nav-link">Tutorial</a></div><div class="nav-item"><a href="/document/" class="nav-link router-link-active">Document</a></div><div class="nav-item"><a href="/about/" class="nav-link">About</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Languages</span><span class="arrow right"></span></a><ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----><a href="/document/plugin.html" class="nav-link router-link-exact-active router-link-active">English</a></li><li class="dropdown-item"><!----><a href="/zh/document/plugin.html" class="nav-link">简体中文</a></li></ul></div></div><a href="https://github.com/ServerHubOrg/serverhub-mvc" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header><div class="sidebar-mask"></div><div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/tutorial/" class="nav-link">Tutorial</a></div><div class="nav-item"><a href="/document/" class="nav-link router-link-active">Document</a></div><div class="nav-item"><a href="/about/" class="nav-link">About</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Languages</span><span class="arrow right"></span></a><ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----><a href="/document/plugin.html" class="nav-link router-link-exact-active router-link-active">English</a></li><li class="dropdown-item"><!----><a href="/zh/document/plugin.html" class="nav-link">简体中文</a></li></ul></div></div><a href="https://github.com/ServerHubOrg/serverhub-mvc" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav><ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span>Document</span><!----></p><ul class="sidebar-group-items"><li><a href="/document/" class="sidebar-link">Document</a></li><li><a href="/document/run-module-method.html" class="sidebar-link">Run() Module Method</a></li><li><a href="/document/controller.html" class="sidebar-link">Controllers</a></li><li><a href="/document/route.html" class="sidebar-link">Route</a></li><li><a href="/document/plugin.html" class="active sidebar-link">Plugin</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/document/plugin.html#plugin-hooks" class="sidebar-link">Plugin hooks</a></li><li class="sidebar-sub-header"><a href="/document/plugin.html#how-to-compose-a-plugin" class="sidebar-link">How to compose a plugin</a></li><li class="sidebar-sub-header"><a href="/document/plugin.html#important-things-to-remember" class="sidebar-link">Important things to remember</a></li></ul></li><li><a href="/document/database.html" class="sidebar-link">Database</a></li><li><a href="/document/middleware.html" class="sidebar-link">Middleware</a></li><li><a href="/document/archive.html" class="sidebar-link">Archives</a></li></ul></div></li></ul></div><div class="page"><div class="content"><h1 id="plugin"><a href="#plugin" aria-hidden="true" class="header-anchor">#</a> Plugin</h1><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>avaliable since v1.0.0-beta</p></div><p>As ServerHub is the foundation of a web server, if you start everything from scratch, then you have to handle with plenty of very basic operations. Just because ServerHub automatically route requests to the corresponding handlers (controllers or static cache), you cannot operate on everything seperately. How about doing something right before routing? Like authentication or filtering. And how about doing something after routing? Like triggering a statistic listener that help you analysis system performance.</p><p>Here, we introduce &quot;plugin&quot; to you. Instructions in this document is pretty simple, but don't miss the chance to build your own plugin!</p><h2 id="plugin-hooks"><a href="#plugin-hooks" aria-hidden="true" class="header-anchor">#</a> Plugin hooks</h2><p>Let's see a picture first. (Tips: right click on the image and choose &quot;open image in new tab&quot; to view high definition image)</p><p><img src="/assets/serverhub-module-plugin-sequence.png" alt="plugin"></p><p>So, when an HTTP request enters ServerHub, it will be handled with ServerHub core module. Then the first phase of plugins will be activated. After all of them successfully go through the data, ServerHub will call route functions to generate a corresponding <code>RouteResult</code>, which contains information about how the request should be handled (where, who). Next, the other phase of plugins will be activated to operate on the data.</p><p>The two phase of plugins are <strong>before-route</strong> plugin and <strong>after-route</strong> plugin.</p><p>Before-route plugins usually do not care about where will the request be sent to with route. It can do some global operations like authentication. After-route plugins usually concentrate on one specific kind of different request types. Some receive requests for controllers while others focus on handling cache-able static resources.</p><h2 id="how-to-compose-a-plugin"><a href="#how-to-compose-a-plugin" aria-hidden="true" class="header-anchor">#</a> How to compose a plugin</h2><p>A plugin is exactly a Node.js module. It has to obey all the rules for Node.js modules. But here are some limits:</p><ul><li><p>A valid plugin must have at least the following properties:</p><ul><li><code>app_name</code> A unique name for your plugin. All the letters must be in lower cases. Valid ones include alphanumeric characters and single dashes, eg: serverhub-plugin-my-filter (the serverhub-plugin- prefix is required).</li><li><code>version</code> Version tag for your plugin. Suggested to follow NPM custom.</li><li><code>version_support</code> Indicates the least version of ServerHub to run the plugin.</li><li><code>phase</code> Whether this is a after-route or before-route plugin.</li><li><code>main</code> Entry function for your plugin. For before-route plugins, 2 parameters are required; for after-route plugins, 3 parameters are requried.</li></ul></li><li><p>Here is an example</p></li></ul><div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  app_name<span class="token punctuation">:</span> <span class="token string">&quot;serverhub-plugin-my-plugin&quot;</span><span class="token punctuation">,</span>
  version<span class="token punctuation">:</span> <span class="token string">&quot;0.1.0&quot;</span><span class="token punctuation">,</span>
  version_support<span class="token punctuation">:</span> <span class="token string">&quot;1.0.0-alpha&quot;</span><span class="token punctuation">,</span>
  phase<span class="token punctuation">:</span> <span class="token string">&quot;before-route&quot;</span><span class="token punctuation">,</span>
  main<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Hello, this is my first ServerHub plugin!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="important-things-to-remember"><a href="#important-things-to-remember" aria-hidden="true" class="header-anchor">#</a> Important things to remember</h2><div class="warning custom-block"><p class="custom-block-title">Keep this in mind:</p><p><strong>NEVER try to modify response parameter passing to your plugin <code>main</code> function!</strong></p></div></div><div class="page-edit"><div class="edit-link"><a href="https://github.com/ServerHubOrg/serverhub-docs/edit/dev/docs/document/plugin.md" target="_blank" rel="noopener noreferrer">Edit this page on Github</a><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div><!----></div><div class="page-nav"><p class="inner"><span class="prev"><i class="material-icons">arrow_back</i><a href="/document/route.html" class="prev">
          Route
        </a></span><span class="next"><a href="/document/database.html">
          Database
        </a><i class="material-icons">arrow_forward</i></span></p></div></div></div></div>
    <script src="/assets/js/13.1300dbff.js" defer></script><script src="/assets/js/app.1dd38295.js" defer></script>
  </body>
</html>
