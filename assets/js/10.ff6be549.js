(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{176:function(t,s,a){"use strict";a.r(s);var n=a(0),e=Object(n.a)({},function(){this.$createElement;this._self._c;return this._m(0)},[function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"content"},[a("h1",{attrs:{id:"controllers"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#controllers","aria-hidden":"true"}},[t._v("#")]),t._v(" Controllers")]),a("p",[t._v("Controllers are very important and extremely basic. Routed path will dispatch actions defined in each controller. In this article, we will discuss about controller composing and other essential parts you need to notice.")]),a("h2",{attrs:{id:"controller-composing"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#controller-composing","aria-hidden":"true"}},[t._v("#")]),t._v(" Controller Composing")]),a("p",[t._v("Here is a good example of "),a("code",[t._v("home.js")]),t._v(" custom controller:")]),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{attrs:{class:"token string"}},[t._v('"use strict"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  index"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("function")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("req"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" res"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" method"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("this")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("View")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  primary"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("function")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("req"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" res"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" method"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{attrs:{class:"token keyword"}},[t._v("var")]),t._v(" context "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("this")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("View")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    context"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v('"Ziyuan"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" context"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("Controller files are plain but special JavaScript files. you must return an object providing "),a("strong",[t._v("action functions")]),t._v(" to ServerHub. So when ServerHub dispatching after routing, your custom controller actions can be invoked.")]),a("p",[t._v("There are three primary paramters of a controller action method: "),a("em",[t._v("request")]),t._v(", "),a("em",[t._v("response")]),t._v(" and "),a("em",[t._v("method")]),t._v(". They are all required.")]),a("ul",[a("li",[a("strong",[a("em",[t._v("request")])]),t._v(" refers to the "),a("em",[t._v("IncomingMessage")]),t._v(" of Node.js.")]),a("li",[a("strong",[a("em",[t._v("response")])]),t._v(" refers to the "),a("em",[t._v("ServerResponse")]),t._v(" object of the request.")]),a("li",[a("strong",[a("em",[t._v("method")])]),t._v(" is a string and can be the following: GET, POST, PATCH, UPDATE, DELETE and PUT.")])]),a("h2",{attrs:{id:"compile-time-and-static-controllers"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#compile-time-and-static-controllers","aria-hidden":"true"}},[t._v("#")]),t._v(" Compile-time and Static Controllers")]),a("p",[t._v("If you modify any controller files while ServerHub running, check if your browser will show you the latest modifications. There will be no effect when you refresh the web pages. ServerHub loads and registers controllers when the application first starts. And it will never automatically update these files. Not like views and models, ServerHub always cache and renew cached content for them. So that ServerHub can be both fast and stable.")]),a("p",[t._v("So, never try to change controller files during ServerHub running.")]),a("h2",{attrs:{id:"controller-scope-variables"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#controller-scope-variables","aria-hidden":"true"}},[t._v("#")]),t._v(" Controller Scope Variables")]),a("p",[t._v("There are several variables that can be accessed inside controller actions. In order to use them, you must explicitly use pointer "),a("strong",[a("em",[t._v("this")])]),t._v(" as a reference to the controller instance. Or, there will be an error message displayed.")]),a("p",[t._v("You are suggested to use "),a("strong",[t._v("arrow functions")]),t._v(" that accessible since ECMAScript 2015. Or, you may use some workaround to access to those variables (closure or something else).")]),a("h3",{attrs:{id:"complete-list-of-supported-controller-scope-variables"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#complete-list-of-supported-controller-scope-variables","aria-hidden":"true"}},[t._v("#")]),t._v(" Complete list of supported controller scope variables")]),a("p",[t._v("Usage of these variables are avaliable at "),a("code",[t._v("doc/variables/{VariableName}.md")]),t._v(". Some variables that have primitive types like "),a("code",[t._v("string")]),t._v(", "),a("code",[t._v("number")]),t._v(" etc. (as well as some reference to vanilla Node.js implementation) will not be doced, FYI.")]),a("ul",[a("li",[a("p",[a("code",[t._v("this.View()")]),a("strong",[a("em",[t._v("Function")])]),t._v(" Returns the corresponding model file.")])]),a("li",[a("p",[a("code",[t._v("this.Runtime")]),a("strong",[a("em",[t._v("Object")])]),t._v(" Contains bunch of other runtime features.")]),a("ol",[a("li",[a("code",[t._v("this.Runtime.DBProvider")]),a("strong",[a("em",[t._v("Object")])]),t._v(" A reference to initialized database provider instanced (default MySQL).")]),a("li",[a("code",[t._v("this.Runtime.FileHelper")]),a("strong",[a("em",[t._v("Object")])]),t._v(" A reference to FileHelper object.")]),a("li",[a("code",[t._v("this.Runtime.WAIT")]),a("strong",[a("em",[t._v("boolean")])]),t._v(" Force to hold connection until asynchronous operations done.")])])]),a("li",[a("p",[a("code",[t._v("this.System")]),a("strong",[a("em",[t._v("Object")])]),t._v(" Provide bunch of readonly constants inside ServerHub instance.")]),a("ol",[a("li",[a("code",[t._v("this.System.Version")]),a("strong",[a("em",[t._v("string")])]),t._v(" ServerHub version.")]),a("li",[a("code",[t._v("this.System.NodeVersion")]),a("strong",[a("em",[t._v("string")])]),t._v(" Node.js version.")]),a("li",[a("code",[t._v("this.System.Platform")]),a("strong",[a("em",[t._v("string")])]),t._v(" Platform information (win32, linux, etc.).")]),a("li",[a("code",[t._v("this.System.Hardware")]),a("strong",[a("em",[t._v("Object")])]),t._v(" Bunch of information about hardware.\n"),a("ul",[a("li",[a("code",[t._v("this.System.Hardware.TotalMemory")]),a("strong",[a("em",[t._v("number")])]),t._v(" Installed memory size (byte).")]),a("li",[a("code",[t._v("this.System.Hardware.FreeMemory")]),a("strong",[a("em",[t._v("number")])]),t._v(" Free memory size (byte).")]),a("li",[a("code",[t._v("this.System.Hardware.NetworkInterfaces")]),a("strong",[a("em",[t._v("Object")])]),t._v(" Returns interfaces that have been assigned a network address.")])])]),a("li",[a("code",[t._v("this.System.Die(exit_code)")]),a("strong",[a("em",[t._v("Function")])]),t._v(" Exit current ServerHub process.")])])])]),a("h2",{attrs:{id:"actions-in-controller"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#actions-in-controller","aria-hidden":"true"}},[t._v("#")]),t._v(" Actions in Controller")]),a("p",[t._v("Actions are methods that been invoked when the HTTP request matches a certain route path. And it handles the request and operates on the response. In this chapter, we will discuss about actions in controller and help you learn more about ServerHub controllers.")]),a("h3",{attrs:{id:"how-to-compose-an-action"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#how-to-compose-an-action","aria-hidden":"true"}},[t._v("#")]),t._v(" How to compose an action")]),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("index"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("request"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" response"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" method"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{attrs:{class:"token comment"}},[t._v("// do something")]),t._v("\n    "),a("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("this")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("View")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("See, this is a very simple 'index' action. You need to declare the action as a function member of an object and return the object as the controller instance. One more thing, as we've mentioned a lot, you should always use 'this' pointer while referencing controller scope variables.")]),a("p",[t._v("There are three parameters and they are all required. If you want to manually control server response by calling methods like "),a("code",[t._v("res.write()")]),t._v(", then ServerHub will ignore default render process, which means:")]),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("index"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("request"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" response"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" method"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    response"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("write")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'Hello, XWZ'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("this")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("View")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("will only output 'Hello, XWZ' and the return value of 'index' action gonna be ignored.")]),a("p",[t._v("The "),a("code",[t._v("request")]),t._v(" parameter is the vanilla Node.js request (aka "),a("code",[t._v("IncomingMessage")]),t._v(" object) (at version 0.0.7). But the "),a("code",[t._v("response")]),t._v(" parameter is a virtual "),a("code",[t._v("ServerResponse")]),t._v(" object. Several methods and properties are wrapped on that object, which are not exactly the same as the original one. Read the document before invoking. "),a("code",[t._v("Method")]),t._v(" is a string that tells the current HTTP method (like GET, POST, etc).")]),a("h3",{attrs:{id:"action-name-convention"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#action-name-convention","aria-hidden":"true"}},[t._v("#")]),t._v(" Action name convention")]),a("p",[t._v("Action names are all written in lower cases. Characters from 'a' to 'z', with numbers and '_' (underscore) are allowed. There are several reserved action names that you cannot use: Runtime, System, Console, View.")]),a("p",[t._v("The best practice are using single words as action names, and verbs are prefered. An action name with more 20 characters are pretty bad. And you should know that in later versions of ServerHub, maybe there will be an limitation of action name length, which might not run functional normally with your old-fashioned code.")]),a("h2",{attrs:{id:"about-syntax"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#about-syntax","aria-hidden":"true"}},[t._v("#")]),t._v(" About Syntax")]),a("p",[t._v("If you use some lint tools, ServerHub's controller file may report syntax errors. It could tell that \""),a("em",[t._v("return statement outside function")]),t._v('". But actually they are valid '),a("strong",[t._v("partial")]),t._v(" JavaScript files.")]),a("p",[t._v("Controllers scripts are all "),a("strong",[t._v("functions")]),t._v(", they are not independent JavaScript files. When you try to execute controller files directly, it is not gonna work.")]),a("p",[t._v("Here is an example. We have a controller file like this ("),a("code",[t._v("home.js")]),t._v("):")]),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{attrs:{class:"token string"}},[t._v('"use strict"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  index"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("function")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("req"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" res"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" method"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("this")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("View")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("If you treat this "),a("code",[t._v("home.js")]),t._v(" as a plain JavaScript file, there should be curly braces surrounding the return statement. Check this:")]),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{attrs:{class:"token string"}},[t._v('"use strict"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        index"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("function")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("req"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" res"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" method"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("this")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("View")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("Now, it is an absolute JavaScript file.")]),a("p",[a("strong",[t._v("But, do you remember that our controllers are all "),a("em",[t._v("functions")])]),t._v("? What does this mean? Your whole controller file is a function, and it has invisible boundries which are curly braces. So, if we manually add function definition to controller file, the loaded controller will be like:")]),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{attrs:{class:"token string"}},[t._v('"use strict"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),a("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            index"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("function")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("req"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" res"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" method"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),a("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("this")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("View")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v('As you can see, there is a redundant pair of function braces that should be removed. And this is why we call ServerHub controllers "partial JavaScript files".')])])}],!1,null,null,null);s.default=e.exports}}]);